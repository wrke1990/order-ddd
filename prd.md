# 电商订单系统 - 产品需求文档 (PRD)

## 项目背景
开发一款高性能的电商订单系统

## 外部系统依赖
1. **用户系统**：获取用户和地址等信息
2. **商品系统**：获取商品名称、图片、价格和库存等信息
3. **促销系统**：获取优惠券和促销活动
4. **支付系统**：创建支付单
5. **履约系统**：正向履约发货、逆向履约收货、物流轨迹变更通知

## 功能需求

### 1. 购物车功能
1. 通过商详页添加到购物车
2. 购物车列表展示购物车信息，区分商品状态
3. 购物车列表进行商品数量的加、减、删除单个商品、删除全部下架商品和删除全部商品

### 2. 订单功能
1. **下单流程**：
   - 通过购物车列表去下单，选项对应地址和优惠券，转换成订单，有效期为15分钟
   - 需要进行库存、配送范围校验
   - 同时还需要考虑到并发场景，导致实际到手价金额与用户下单时展示金额不一致的问题

2. **订单支付**：
   - 用户订单支付，支付后需要通知履约系统发货

3. **订单取消**：
   - 用户订单取消，支付后需求需要通知履约系统拦截发货

4. **自动取消**：
   - 超时自动取消

5. **订单列表**：
   - 分类展示：全部、待支付、待发货、待收货、已完成（包括正常确认收货、取消、售后完成）

6. **订单详情**：
   - 可以添加缓存，要防止缓存击穿、穿透等问题

7. **订单确认收货**：
   - 用户订单确认收货

8. **地址修改**：
   - 未发货时可以修改地址，修改地址后需要通知履约系统变更地址

9. **支付方式修改**：
   - 未支付时可以修改支付方式，需要生成新的支付单

### 3. 履约功能
1. **发货**：正向履约发货
2. **物流轨迹**：更新物流轨迹，可以添加缓存，要防止缓存击穿、穿透等问题

### 4. 售后功能
1. **售后发起**：
   - 通过订单发起售后，售后类型为：
     - 在未发货状态下仅退款，退全额
     - 在已发货的时候可以为仅退款和退货退款
   - 退款可以部分退，退货退款时，退款金额需要扣减未退回的商品金额
   - 退货需要逆向物流，也可以退货部分商品，退货寄出后需要通知履约系统待收货，逆向履约完成后，订单才能完结

2. **客服售后**：
   - 客服可以在后台发起超级退：订单支付后，无论什么状态，都可以退款，退款金额区间在零到全额

3. **售后进度**：
   - 查看售后进度